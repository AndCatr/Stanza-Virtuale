<!DOCTYPE html>
<html>
<head>
    <title>Stanza Virtuale</title>
    <script>
        function aggiornaChat() {
            fetch("/aggiorna_chat/{{ codice }}")
            .then(response => response.json())
            .then(data => {
                let chatBox = document.getElementById("chat");
                chatBox.innerHTML = "";
                data.chat.forEach(msg => {
                    let item = document.createElement("li");
                    item.innerHTML = `<strong>${msg[0]}:</strong> ${msg[1]}`;
                    chatBox.appendChild(item);
                });
            });
        }

        function inviaNumero() {
            let numero = document.getElementById("numero").value;
            fetch("/invia_numero/{{ codice }}", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: "numero=" + numero
            }).then(response => response.json())
              .then(data => {
                if (data.success) {
                    document.getElementById("numero").value = "";
                }
            });
        }

        function aggiornaCountdown() {
            fetch("/verifica_countdown/{{ codice }}")
            .then(response => response.json())
            .then(data => {
                let countdownBox = document.getElementById("countdown");
                if (data.countdown === null) {
                    countdownBox.innerHTML = "Attesa numeri...";
                } else if (data.countdown > 0) {
                    countdownBox.innerHTML = `Tempo rimanente: ${data.countdown} secondi`;
                } else {
                    countdownBox.innerHTML = "Tempo scaduto!";
                }
            });
        }

        setInterval(aggiornaChat, 3000);
        setInterval(aggiornaCountdown, 1000);
    </script>
</head>
<body>
    <h1>Stanza Virtuale: {{ codice }}</h1>

    <h2>Chat</h2>
    <ul id="chat"></ul>

    <h2>Numeri di telefono</h2>
    <p>Penelope: <span id="numero_penelope">{{ numero_penelope }}</span></p>
    <p>Eric: <span id="numero_eric">{{ numero_eric }}</span></p>

    <h2>Inserisci il tuo numero</h2>
    <input type="text" id="numero" placeholder="Numero di telefono">
    <button onclick="inviaNumero()">Invia</button>

    <h2>Countdown</h2>
    <p id="countdown">{{ countdown }}</p>
</body>
</html>
